<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <cc:interface>
        <cc:attribute name="bill" required="true"/>
        <cc:attribute name="transactions" required="true"/>
    </cc:interface>

    <cc:implementation>
        <style>
            /* Styling for A4 Page */
            @page {
                size: A4;
                margin: 10mm;
            }

            .a4-page {
                width: 210mm;
                min-height: 297mm;
                margin: 0 auto;
                padding: 15mm;
                background: white;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            }

            @media print {
                .a4-page {
                    box-shadow: none;
                    margin: 0;
                    page-break-after: always;
                }

                .no-print {
                    display: none !important;
                }
            }

            /* Professional table styling */
            .bill-table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
                font-size: 12px;
            }

            .bill-table th {
                background-color: #f8f9fa;
                border: 1px solid #333;
                padding: 8px;
                text-align: left;
                font-weight: bold;
            }

            .bill-table td {
                border: 1px solid #333;
                padding: 6px 8px;
            }

            .bill-info-table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
            }

            .bill-info-table td {
                padding: 5px;
                border: 1px solid #333;
            }

            .bill-info-table td:first-child {
                font-weight: bold;
                width: 30%;
                background-color: #f8f9fa;
            }

            .bill-header {
                text-align: center;
                margin-bottom: 20px;
                border-bottom: 2px solid #333;
                padding-bottom: 10px;
            }

            .signature-section {
                margin-top: 50px;
                display: table;
                width: 100%;
            }

            .signature-box {
                display: table-cell;
                width: 33%;
                padding: 10px;
                vertical-align: top;
            }

            .signature-line {
                border-top: 1px solid #333;
                margin-top: 60px;
                padding-top: 5px;
            }

            .signature-label {
                font-weight: bold;
                margin-bottom: 5px;
            }

            .logo-section {
                text-align: center;
                margin-bottom: 15px;
            }
        </style>

        <div class="a4-page" id="billPanel">
            <!-- Logo Section -->
            <div class="logo-section">
                <div style="display: inline-block; margin: 0 10px;">
                    <h:graphicImage style="height: 5em;" library="image" name="jf.png"/>
                </div>
                <div style="display: inline-block; margin: 0 10px;">
                    <h:graphicImage style="height: 5em;" library="image" name="slf.png"/>
                </div>
            </div>

            <div class="logo-section" style="margin-top: 10px;">
                <div style="display: inline-block; margin: 0 10px;">
                    <h:graphicImage style="height: 4em;" library="image" name="cpc.png"/>
                </div>
                <div style="display: inline-block; margin: 0 10px;">
                    <h:graphicImage style="height: 4em; width: 120px;" library="image" name="jics.svg"/>
                </div>
                <div style="display: inline-block; margin: 0 10px;">
                    <h:graphicImage style="height: 4em;" library="image" name="sl.png"/>
                </div>
            </div>

            <!-- Bill Header -->
            <div class="bill-header">
                <h2 style="margin: 10px 0;">FUEL PAYMENT REQUEST</h2>
            </div>

            <!-- Bill Information Table -->
            <table class="bill-info-table">
                <tr>
                    <td>Bill Number:</td>
                    <td><h:outputText value="#{cc.attrs.bill.billNo}"/></td>
                </tr>
                <tr>
                    <td>Institution:</td>
                    <td><h:outputText value="#{cc.attrs.bill.fromInstitution.name}"/></td>
                </tr>
                <tr>
                    <td>Fuel Station:</td>
                    <td><h:outputText value="#{cc.attrs.bill.toInstitution.name}"/></td>
                </tr>
                <tr>
                    <td>Dealer Number:</td>
                    <td><h:outputText value="#{cc.attrs.bill.toInstitution.code}"/></td>
                </tr>
                <tr>
                    <td>Request Date:</td>
                    <td>
                        <h:outputText value="#{cc.attrs.bill.billDate}">
                            <f:convertDateTime pattern="dd MMMM yyyy"/>
                        </h:outputText>
                    </td>
                </tr>
            </table>

            <!-- Transactions Table with Serial Numbers -->
            <h3 style="margin-top: 20px; margin-bottom: 10px;">Transaction Details</h3>

            <!-- Calculate Total Issued Quantity -->
            <c:set var="totalIssuedQty" value="0" />
            <ui:repeat value="#{cc.attrs.transactions}" var="trans">
                <c:set var="totalIssuedQty" value="#{totalIssuedQty + (trans.issued ? trans.issuedQuantity : 0)}" />
            </ui:repeat>

            <table class="bill-table">
                <thead>
                    <tr>
                        <th style="width: 40px; text-align: center;">No.</th>
                        <th>Vehicle</th>
                        <th>Request Ref. No</th>
                        <th>Requested Date</th>
                        <th style="text-align: right;">Requested Qty.</th>
                        <th>Issued Date</th>
                        <th style="text-align: right;">Issued Qty.</th>
                        <th>Issue Ref. No</th>
                    </tr>
                </thead>
                <tbody>
                    <ui:repeat value="#{cc.attrs.transactions}" var="transaction" varStatus="status">
                        <tr>
                            <td style="text-align: center;">#{status.index + 1}</td>
                            <td><h:outputText value="#{transaction.vehicle.vehicleNumber}"/></td>
                            <td><h:outputText value="#{transaction.requestReferenceNumber}"/></td>
                            <td>
                                <h:outputText value="#{transaction.requestedDate}">
                                    <f:convertDateTime pattern="dd MMM yyyy"/>
                                </h:outputText>
                            </td>
                            <td style="text-align: right;">
                                <h:outputText value="#{transaction.requestQuantity}">
                                    <f:convertNumber pattern="#,##0.00"/>
                                </h:outputText>
                            </td>
                            <td>
                                <h:outputText value="#{transaction.issuedDate}" rendered="#{transaction.issued}">
                                    <f:convertDateTime pattern="dd MMM yyyy"/>
                                </h:outputText>
                                <h:outputText value="Not Issued" style="color: red; font-style: italic;"
                                              rendered="#{not transaction.issued}"/>
                            </td>
                            <td style="text-align: right;">
                                <h:outputText value="#{transaction.issuedQuantity}" rendered="#{transaction.issued}">
                                    <f:convertNumber pattern="#,##0.00"/>
                                </h:outputText>
                                <h:outputText value="-" rendered="#{not transaction.issued}"/>
                            </td>
                            <td><h:outputText value="#{transaction.issueReferenceNumber}"/></td>
                        </tr>
                    </ui:repeat>
                </tbody>
                <tfoot>
                    <tr style="font-weight: bold; background-color: #e9ecef;">
                        <td colspan="3" style="text-align: right;"></td>
                        <td style="text-align: right;">Total Requested Qty:</td>
                        <td style="text-align: right;">
                            <h:outputText value="#{cc.attrs.bill.totalQty}">
                                <f:convertNumber pattern="#,##0.00"/>
                            </h:outputText> Liters
                        </td>
                        <td style="text-align: right;">Total Issued Qty:</td>
                        <td style="text-align: right;">
                            <h:outputText value="#{totalIssuedQty}">
                                <f:convertNumber pattern="#,##0.00"/>
                            </h:outputText> Liters
                        </td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>

            <!-- Signature Section -->
            <div class="signature-section">
                <div class="signature-box">
                    <div class="signature-label">Created By:</div>
                    <div>Name: ...................................</div>
                    <div class="signature-line">
                        Signature: ..............................
                    </div>
                </div>

                <div class="signature-box">
                    <div class="signature-label">Checked By:</div>
                    <div>Name: ...................................</div>
                    <div class="signature-line">
                        Signature: ..............................
                    </div>
                </div>

                <div class="signature-box">
                    <div class="signature-label">Approved By:</div>
                    <div>Name: ...................................</div>
                    <div class="signature-line">
                        Signature: ..............................
                    </div>
                </div>
            </div>

            <!-- Footer Note -->
            <div style="margin-top: 30px; padding: 10px; border-top: 1px solid #333; font-size: 10px; text-align: center; color: #666;">
                This is an official document generated by the Fuel Management Information System (FMIS)
            </div>
        </div>
    </cc:implementation>
</html>
