<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:body>

        <ui:composition template="./index.xhtml">

            <ui:define name="reports">
                <h:form>
                    <div class="card">
                        <div class="card-header">
                            <h:outputLabel value="Retire Undispensed Fuel Orders" />
                        </div>
                        <div class="card-body">

                            <!-- Filter Section -->
                            <p:panel header="Search Criteria">
                                <p:panelGrid layout="tabular" columns="6" class="w-100">
                                    <p:outputLabel value="From Date:" />
                                    <p:datePicker
                                        value="#{reportController.fromDate}"
                                        pattern="dd MMMM yyyy"
                                        styleClass="w-100">
                                    </p:datePicker>

                                    <p:outputLabel value="To Date:" />
                                    <p:datePicker
                                        value="#{reportController.toDate}"
                                        pattern="dd MMMM yyyy"
                                        styleClass="w-100">
                                    </p:datePicker>

                                    <p:commandButton
                                        value="Search"
                                        icon="pi pi-search"
                                        ajax="false"
                                        action="#{reportController.fillUndispensedFuelOrders()}"
                                        styleClass="ui-button-info">
                                    </p:commandButton>
                                </p:panelGrid>
                            </p:panel>

                            <!-- Instructions Panel -->
                            <p:panel header="Instructions" styleClass="mt-3">
                                <p>This page allows you to retire fuel orders that have not been issued (confirmed) and have not been dispensed.</p>
                                <p><strong>Steps:</strong></p>
                                <ol>
                                    <li>Select the date range and click "Search" to list all undispensed fuel orders</li>
                                    <li>Select the transactions you want to retire using the checkboxes</li>
                                    <li>Click the "Retire Selected Orders" button at the bottom</li>
                                    <li>Retired transactions will appear in the "List of Deleted Transactions" report</li>
                                </ol>
                            </p:panel>

                            <!-- Results Table -->
                            <h:panelGroup rendered="#{reportController.transactionLights != null and reportController.transactionLights.size() > 0}">
                                <p:dataTable
                                    var="transaction"
                                    class="w-100 mt-3"
                                    value="#{reportController.transactionLights}"
                                    selection="#{reportController.selectedTransactionsToRetire}"
                                    paginator="true"
                                    rows="10"
                                    rowKey="#{transaction.id}"
                                    selectionMode="multiple"
                                    selectionPageOnly="false"
                                    paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                    rowsPerPageTemplate="10,20,50"
                                    currentPageReportTemplate="Showing {startRecord} to {endRecord} of {totalRecords} entries">

                                    <f:facet name="header">
                                        Undispensed Fuel Orders
                                    </f:facet>

                                    <p:column selectionBox="true" style="width:3rem" exportable="false"/>

                                    <p:column headerText="Date" sortBy="#{transaction.date}" filterBy="#{transaction.date}" filterMatchMode="contains">
                                        <h:outputText value="#{transaction.date}">
                                            <f:convertDateTime pattern="dd/MM/yyyy" />
                                        </h:outputText>
                                    </p:column>

                                    <p:column headerText="Transaction Type" sortBy="#{transaction.transactionTypeLabel}" filterBy="#{transaction.transactionTypeLabel}" filterMatchMode="contains">
                                        <h:outputText value="#{transaction.transactionTypeLabel}" />
                                    </p:column>

                                    <p:column headerText="Institution" sortBy="#{transaction.fromInstitutionName}" filterBy="#{transaction.fromInstitutionName}" filterMatchMode="contains">
                                        <h:outputText value="#{transaction.fromInstitutionName}" />
                                    </p:column>

                                    <p:column headerText="Fuel Station" sortBy="#{transaction.toInstitutionName}" filterBy="#{transaction.toInstitutionName}" filterMatchMode="contains">
                                        <h:outputText value="#{transaction.toInstitutionName}" />
                                    </p:column>

                                    <p:column headerText="Request Reference No" sortBy="#{transaction.requestReferenceNumber}" filterBy="#{transaction.requestReferenceNumber}" filterMatchMode="contains">
                                        <h:outputText value="#{transaction.requestReferenceNumber}" />
                                    </p:column>

                                    <p:column headerText="Vehicle Number" sortBy="#{transaction.vehicleNumber}" filterBy="#{transaction.vehicleNumber}" filterMatchMode="contains">
                                        <h:outputText value="#{transaction.vehicleNumber}" />
                                    </p:column>

                                    <p:column headerText="Driver Name" sortBy="#{transaction.driverName}" filterBy="#{transaction.driverName}" filterMatchMode="contains">
                                        <h:outputText value="#{transaction.driverName}" />
                                    </p:column>

                                    <p:column headerText="Requested Qty" sortBy="#{transaction.requestQuantity}">
                                        <h:outputText value="#{transaction.requestQuantity}" />
                                    </p:column>

                                    <f:facet name="footer">
                                        <p:commandButton
                                            value="Retire Selected Orders"
                                            icon="pi pi-trash"
                                            ajax="false"
                                            action="#{reportController.retireSelectedFuelOrders()}"
                                            styleClass="ui-button-danger"
                                            onclick="return confirm('Are you sure you want to retire the selected fuel orders? This action will mark them as deleted.');">
                                        </p:commandButton>
                                    </f:facet>

                                </p:dataTable>

                            </h:panelGroup>

                            <h:panelGroup rendered="#{reportController.transactionLights == null or reportController.transactionLights.size() == 0}">
                                <p:panel styleClass="mt-3">
                                    <div class="text-center p-5">
                                        <i class="pi pi-inbox" style="font-size: 3rem; color: #999;"></i>
                                        <h4>No Undispensed Fuel Orders Found</h4>
                                        <p>Select a date range and click "Search" to view undispensed fuel orders.</p>
                                    </div>
                                </p:panel>
                            </h:panelGroup>

                        </div>
                    </div>
                </h:form>
            </ui:define>

        </ui:composition>

    </h:body>
</html>
