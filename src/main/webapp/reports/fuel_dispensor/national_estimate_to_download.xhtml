<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:body>
        <ui:composition template="./index.xhtml">
            <ui:define name="reports">
                <h:form>

                    <p:commandButton value="Process"
                                     ajax="false"
                                     action="#{reportController.fillAllHospitalsEstimatesToDownload}"
                                     class="ui-button-success m-1" />

                    <p:commandButton value="Process"
                                     ajax="false"
                                     action="#{reportController.fillAllHospitalsEstimatesToPrint}"
                                     class="ui-button-success m-1" />
                    <!-- Data Export Buttons -->
                    <p:commandButton  ajax="false" value="Export to PDF" type="button" class="ui-button-success m-1">
                        <p:dataExporter type="pdf" target="fuelEstimateTable" fileName="FuelEstimates" class="ui-button-success m-1" />
                    </p:commandButton>

                    <p:commandButton ajax="false" value="Export to Excel" type="button" class="ui-button-success m-1">
                        <p:dataExporter type="csv" target="fuelEstimateTable"
                                        
                                        fileName="FuelEstimates"  />
                    </p:commandButton>

                    <p:commandButton ajax="false" value="Print" type="button" icon="pi pi-print" class="ui-button-success m-1" >
                        <p:printer target="fuelEstimateTable" />
                    </p:commandButton>



                    <p:dataTable id="fuelEstimateTable"  
                                 rendered="true"
                                 var="row" value="#{reportController.fuelEstimateRows}" styleClass="table table-bordered">


                        <p:column headerText="CPC No">
                            #{row.fuelStation.code}
                        </p:column>
                        <p:column headerText="Fuel Station Name">
                            #{row.fuelStation.name}
                        </p:column>
                        <p:column headerText="Location">
                            #{row.fuelStation.address}
                        </p:column>
                        <p:column headerText="District">
                            #{row.fuelStation.district.name}
                        </p:column>
                        <p:column headerText="Fuel Station Estimate">
                            #{row.fuelStationEstimate}
                        </p:column>
                        <p:column headerText="Institution">
                            #{row.institution != null ? row.institution.name : ''}
                        </p:column>
                        <p:column headerText="Parent">
                            #{row.institution != null ? row.institution.parent.name : ''}
                        </p:column>
                        <p:column headerText="Institution Estimate">
                            #{row.institutionEstimate}
                        </p:column>
                        <p:column headerText="Vehicle">
                            #{row.vehicle != null ? row.vehicle.name : ''}
                        </p:column>
                        <p:column headerText="Vehicle Estimate">
                            #{row.totalEstimate}
                        </p:column>
                    </p:dataTable>


                    Fuel Estimate Table 
                    <p:dataTable id="fuelEstimateTable1" rendered="false" var="fuelShed" value="#{reportController.fuelEstimate.fuelShedEstimates}" styleClass="table table-bordered">
                        <p:column headerText="CPC Account No" width="170" filterBy="#{fuelShed.fuelStation.code}" filterMatchMode="contains" sortBy="#{fuelShed.fuelStation.code}">
                            <h:outputLabel value="#{fuelShed.fuelStation.code}" ></h:outputLabel>    
                        </p:column>

                        <p:column headerText="Fuel Station" width="300">
                            <h:outputLabel value="#{fuelShed.fuelStation.name}" ></h:outputLabel>    
                        </p:column>


                        <p:column headerText="Location" width="170" filterBy="#{fuelShed.fuelStation.address}" filterMatchMode="contains" sortBy="#{fuelShed.fuelStation.address}">
                            <h:outputLabel value="#{fuelShed.fuelStation.address}" ></h:outputLabel>    
                        </p:column>
                        <p:column headerText="District" width="170" filterBy="#{fuelShed.fuelStation.district.name}" filterMatchMode="contains" sortBy="#{fuelShed.fuelStation.district.name}">
                            <h:outputLabel value="#{fuelShed.fuelStation.district.name}" ></h:outputLabel>    
                        </p:column>

                        <p:column headerText="Estimate" width="50">
                            <h:outputLabel value="#{fuelShed.fuelShedEstimate}" >
                                <f:convertNumber pattern="0.00" ></f:convertNumber>
                            </h:outputLabel>
                        </p:column>

                        Nested Table for Institutions 
                        <p:column headerText="Institutions" width="560">
                            <p:dataTable var="ie" value="#{fuelShed.institutionEstimates}" styleClass="table table-bordered">
                                <p:column headerText="Institution Name" width="200">
                                    #{ie.institution.name}
                                </p:column>
                                <p:column headerText="Estimate" width="60">
                                    #{ie.institutionFuelEstimate}
                                </p:column>

                                Nested Table for Vehicles 
                                <p:column headerText="Vehicles" width="290">
                                    <p:dataTable var="vehicle" value="#{ie.vehicles}" styleClass="table table-bordered">
                                        <p:column headerText="Vehicle" width="100">
                                            #{vehicle.vehicleNumber}
                                        </p:column>
                                        <p:column headerText="Vehicle" width="100">
                                            #{vehicle.name}
                                        </p:column>
                                        <p:column headerText="Estimate" width="60">
                                            #{vehicle.estiamtedMonthlyFuelConsumption}
                                        </p:column>
                                    </p:dataTable>
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:dataTable>

                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
